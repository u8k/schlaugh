<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>s c h l a u g h</title>
    <link href="https://fonts.googleapis.com/css?family=Crimson+Pro|Gurajada|Lora|Montserrat|Open+Sans|Rajdhani|Roboto|Roboto+Slab|Source+Code+Pro|Space+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/game.css">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js" integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy" crossorigin="anonymous"></script> -->
    <!-- KaTeX -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.css" integrity="sha384-yW1frltt4cd2K6QCmOMx4M+ylOmyrGb+NDouZ1f5VL2f4NN7uBu5PQsmUSgWib1W" crossorigin="anonymous">
    <script async src="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.js" integrity="sha384-97gW6UIJxnlKemYavrqDHSX3SiygeOwIZhwyOKRfSaf0JWKRVj9hLASHgFTzT+0O" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="/katex.css">
    <script  src="/katex.min.js"></script>
    <!-- -->
    <script src="/openpgp.min.js"></script>
    <script src="/jscolor.js"></script>
    <script src="/pool.js"></script>
    <script src="/game.js"></script>
    <script src="/schlaunquer.js"></script>
    <script src="/main.js"></script>
	  <link rel="icon" type="image/png" href="/favicon.png" id='dynamic-favicon'>

    <%
      if(initProps && initProps.authorName) {
    %>
        <link id="rssLink" rel="alternate" type="application/rss+xml" title=<%= initProps.authorName %> href=<%= '/'+initProps.authorName+'/~rss' %>>
    <%
      } else {
    %>
        <link id="rssLink" rel="alternate" type="application/rss+xml" title="schlaugh" href="/~rss">
    <%
      }
    %>

  </head>
  <body>
    <header>
      <h1><a href="/" onclick="backToMain(event);">schlaugh</a></h1>

      <userInfo>
        <user-info-item><a href="javascript:void(0);" id="username" class="clicky removed special"></a></user-info-item>
        <user-info-item><a href="javascript:void(0);" id="sign-in" class="clicky" onclick="passPromptSubmit()">schlaugh in</a></user-info-item>
        <user-info-item><a href="javascript:void(0);" id="sign-out" class="clicky removed" onclick="signOut()">schlaugh out</a></user-info-item>
      </userInfo>
    </header>

    <main id="main">
      <%- include("main") %>
    </main>

    <footer>
      <%
        var date = new Date(new Date().getTime() - 9*3600*1000);  //UTC offset by -9
        var hoursRemaining = "< " + (24 - date.getUTCHours()) + " hours to schlaupdate";
      %>
      <text id="schlaupdate-timer"><%= hoursRemaining %></text> <a href="javascript:void(0);" onclick="schlaupdateExplain()" class="special clicky">(?)</a>
      <br>
      <div id="footer-footer">
        <a href="/~" class="clicky special footer-text" onclick="modKeyCheck(event, function () {switchPanel('meta-panel'); simulatePageLoad('~', false);});">about</a>
        •
        <a href="/~click" class="clicky special footer-text" onclick="modKeyCheck(event, function () {openClickerGame();});">click</a>
        •
        <a href="/~schlaunquer" class="clicky special footer-text" onclick="modKeyCheck(event, function () {openSchlaunquerPanel();});">schlaunquer</a>
      </div>
    </footer>

    <button id="appearance-options-open" class=" filter-focus" onclick="openAppearanceSettings()"><!--  
      --><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 43 43" style="height: 1em;">
        <g transform="translate(0,43) scale(0.1,-0.1)" fill="currentColor">
          <path d="M173 358 c-16 -21 -25 -23 -90 -20 -62 2 -73 0 -73 -13 0 -14 11 -16
          73 -13 65 3 74 1 90 -19 24 -29 60 -29 84 0 16 20 25 22 91 19 61 -2 72 0 72
          13 0 14 -11 16 -72 13 -66 -3 -75 -1 -91 20 -10 12 -29 22 -42 22 -13 0 -32
          -10 -42 -22z m65 -31 c4 -20 -25 -34 -40 -19 -15 15 -1 44 19 40 10 -2 19 -11
          21 -21z"/>
          <path d="M83 246 c-15 -18 -26 -23 -46 -19 -21 4 -27 1 -27 -11 0 -13 7 -17
          28 -14 19 2 33 -4 45 -19 24 -29 60 -29 84 0 17 21 24 22 136 19 102 -3 117
          -1 117 13 0 14 -16 15 -117 13 -112 -3 -119 -2 -136 20 -24 29 -61 28 -84 -2z
          m65 -29 c4 -20 -25 -34 -40 -19 -15 15 -1 44 19 40 10 -2 19 -11 21 -21z"/>
          <path d="M253 138 c-17 -22 -24 -23 -130 -20 -98 3 -113 1 -113 -13 0 -14 15
          -15 113 -13 106 3 113 2 130 -19 24 -30 61 -29 84 1 15 18 26 22 51 18 25 -3
          32 -1 32 12 0 13 -8 17 -32 14 -25 -2 -38 3 -51 20 -10 12 -29 22 -42 22 -13
          0 -32 -10 -42 -22z m65 -31 c4 -20 -25 -34 -40 -19 -15 15 -1 44 19 40 10 -2
          19 -11 21 -21z"/>
        </g>
      </svg><!--
    --></button>
    
    <script type="text/javascript">

    (function router(input) {
      if (input.user && input.settings && input.settings.colors) {
        changeAllColors(input.settings.colors, true)
      } else {
        setAppearance();
      }
      if (input.postCode !== undefined) {
        var params = {
          author:input.author,
          tag:input.tag,
          search:input.search,
          date:input.date,
          page:input.page,
          postCode:input.postCode,
          post_id:input.post_id,         // take in post_id to distingiush between TFTF via a date or an ID
          post_url:input.post_url,       // again, to distingiush TFTF via custom URL
          existed:input.existed,
          notFound:input.notFound,
        }
        if (!input.date || input.postCode === "TFTF" || input.date <= pool.getCurDate()) {
          initSchlaugh(input.user, function () {fetchPosts(true, params);});
        } else {
          if (input.user) {
            initSchlaugh(input.user, function () {switchPanel("posts-panel")});
          } else {
            simulatePageLoad();
            switchPanel("meta-panel");
          }
        }
      } else if (input.panel) {
        if (!input.user && (input.panel !== "about" && input.panel !== "clicker" && input.panel !== "schlaunquer")) {
          simulatePageLoad();
          switchPanel("meta-panel");
        } else if (input.panel === "meta") {
          initSchlaugh(input.user, function () {switchPanel("meta-panel")});
        } else if (input.panel === "clicker") {
          initSchlaugh(input.user, function () {openClickerGame();});
        } else if (input.panel === "schlaunquer") {
          initSchlaugh(input.user, function () {openSchlaunquerPanel(input.game_id, input.day);});
        } else {
          initSchlaugh(input.user, function () {switchPanel(input.panel+"-panel")});
        }
      } else if (input.recovery) {
        if (input.code) {
          switchPanel("recovery-panel"); glo.resetCode = input.code;
        } else {
          switchPanel("bad-recovery-panel");
        }
      } else {  // NONE, just ye good ole schlaugh.com
        if (input.user) {
          initSchlaugh(input.user, function () {switchPanel("posts-panel")});
        } else {
          simulatePageLoad();
          switchPanel("meta-panel");
        }
      }
    })(<%- JSON.stringify(initProps) %>)

  </script>

  </body>
</html>
